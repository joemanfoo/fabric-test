const fs = require('fs')
const { fabric } = require('fabric')
const out = fs.createWriteStream(__dirname + '/helloworld.png');
const path = require('path')
// let Font = require('canvas').Font;

function fontFile (name) {
  return path.join(__dirname, name)
}

const data = {"version":"2.4.1","objects":[{"type":"rect","version":"2.4.1","originX":"left","originY":"top","left":475,"top":5,"width":600,"height":1070,"fill":"rgba(200, 200, 200, 0.5)","stroke":"rgba(0, 0, 0, 0)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0},{"type":"rect","version":"2.4.1","originX":"left","originY":"top","left":5,"top":5,"width":465,"height":600,"fill":"rgba(200, 200, 200, 0.5)","stroke":"rgba(0, 0, 0, 0)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0},{"type":"circle","version":"2.4.1","originX":"left","originY":"top","left":350,"top":400,"width":0,"height":0,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"radius":0,"startAngle":0,"endAngle":6.283185307179586},{"type":"image","version":"2.4.1","originX":"left","originY":"top","left":4,"top":610,"width":465,"height":465,"fill":"rgba(200, 200, 200, 0","stroke":"rgb(0, 0, 0, 0.0)","strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"crossOrigin":"anonymous","cropX":0,"cropY":0,"src":"https://firebasestorage.googleapis.com/v0/b/ezfficient.appspot.com/o/user-templates%2F10154979856454231%2Fuploads%2Fpexels-photo-619420.jpeg?alt=media&token=eccfdd5d-99ea-4268-8fd9-10a72e5e9ac2","filters":[]},{"type":"ellipse","version":"2.4.1","originX":"left","originY":"top","left":350,"top":400,"width":0,"height":0,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0},{"type":"circle","version":"2.4.1","originX":"left","originY":"top","left":350,"top":200,"width":0,"height":0,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"radius":0,"startAngle":0,"endAngle":6.283185307179586},{"type":"rect","version":"2.4.1","originX":"left","originY":"top","left":350,"top":400,"width":200,"height":200,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0},{"type":"ellipse","version":"2.4.1","originX":"left","originY":"top","left":350,"top":200,"width":0,"height":0,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0},{"type":"circle","version":"2.4.1","originX":"left","originY":"top","left":350,"top":50,"width":0,"height":0,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"radius":0,"startAngle":0,"endAngle":6.283185307179586},{"type":"ellipse","version":"2.4.1","originX":"left","originY":"top","left":350,"top":50,"width":0,"height":0,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0},{"type":"rect","version":"2.4.1","originX":"left","originY":"top","left":350,"top":50,"width":200,"height":200,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0},{"type":"triangle","version":"2.4.1","originX":"left","originY":"top","left":350,"top":50,"width":200,"height":100,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0},{"type":"rect","version":"2.4.1","originX":"left","originY":"top","left":350,"top":200,"width":200,"height":200,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"rx":0,"ry":0},{"type":"triangle","version":"2.4.1","originX":"left","originY":"top","left":350,"top":400,"width":200,"height":100,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0},{"type":"triangle","version":"2.4.1","originX":"left","originY":"top","left":350,"top":200,"width":200,"height":100,"fill":"rgba(200, 00, 200, 0.25)","stroke":"rgba(0, 0, 0, 1)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":false,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0},{"type":"i-text","version":"2.4.1","originX":"left","originY":"top","left":48,"top":705,"width":141,"height":101.7,"fill":"rgba(255, 0, 0, 1)","stroke":"rgba(0, 0, 0, 0.0)","strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(254, 209, 65, 0.68)","blur":10,"offsetX":4,"offsetY":4,"affectStroke":false},"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"text":"$25","fontSize":90,"fontWeight":"400","fontFamily":"Eater Caps","fontStyle":"normal","lineHeight":1.16,"underline":false,"overline":false,"linethrough":false,"textAlign":"left","textBackgroundColor":"","charSpacing":0,"styles":{}},{"type":"i-text","version":"2.4.1","originX":"left","originY":"top","left":43,"top":625,"width":388.14,"height":79.1,"fill":"rgba(255, 0, 0, 1)","stroke":"rgba(254, 209, 65, 0.62)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(255, 255, 255, 0.43)","blur":10,"offsetX":4,"offsetY":4,"affectStroke":false},"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"text":"Leggings","fontSize":"70","fontWeight":"400","fontFamily":"Eater Caps","fontStyle":"normal","lineHeight":1.16,"underline":false,"overline":false,"linethrough":false,"textAlign":"left","textBackgroundColor":"","charSpacing":0,"styles":{}},{"type":"i-text","version":"2.4.1","originX":"left","originY":"top","left":281.28,"top":704.19,"width":120,"height":101.7,"fill":"rgba(136, 183, 232, 0.83)","stroke":"rgba(0, 0, 0, 0.0)","strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(135, 138, 140, 0.59)","blur":10,"offsetX":8,"offsetY":8,"affectStroke":false},"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"text":"OS","fontSize":90,"fontWeight":"700","fontFamily":"Josefin Sans","fontStyle":"normal","lineHeight":1.16,"underline":false,"overline":false,"linethrough":false,"textAlign":"left","textBackgroundColor":"","charSpacing":0,"styles":{}},{"type":"image","version":"2.4.1","originX":"left","originY":"top","left":137,"top":973,"width":1500,"height":614,"fill":"rgba(200, 200, 200, 0)","stroke":"rgba(0, 0, 0, 0)","strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":0.13,"scaleY":0.13,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":3,"offsetX":3,"offsetY":3,"affectStroke":false},"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"crossOrigin":"anonymous","cropX":0,"cropY":0,"src":"https://firebasestorage.googleapis.com/v0/b/ezfficient.appspot.com/o/user-templates%2F1057522377634683%2Fuploads%2Flularoe.png?alt=media&token=be50003b-b8cc-44da-8679-60e5f60a6491","filters":[]},{"type":"i-text","version":"2.4.1","originX":"left","originY":"top","left":40,"top":40,"width":383,"height":101,"fill":"rgba(0, 0, 0, 91)","stroke":"rgba(0, 0, 0, .91)","strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":4,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":{"color":"rgba(0, 0, 0, 0)","blur":0,"offsetX":0,"offsetY":0,"affectStroke":false},"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","transformMatrix":null,"skewX":0,"skewY":0,"text":"standard","fontSize":90,"fontWeight":700,"fontFamily":"ABeeZee","fontStyle":"normal","lineHeight":1.16,"underline":false,"overline":false,"linethrough":false,"textAlign":"left","textBackgroundColor":"","charSpacing":0,"styles":{}}],"background":"rgba(255, 255, 255, 1)"}

const canvas = new fabric.StaticCanvas(null, { width: 1080, height:1080 });
let f1 = new fabric.nodeCanvas.Font('Eater Caps', './EaterCaps.ttf')
let f2 = new fabric.nodeCanvas.Font('Josefin Sans', './JosefinSans.ttf')

canvas.contextContainer.addFont(f1)
canvas.contextContainer.addFont(f2)

canvas.loadFromJSON(data, () => {
  const stream = canvas.createPNGStream();
  stream.on('data', function(chunk) {
    out.write(chunk);
  });
})
// canvas.loadFromJSON(data, canvas.renderAll.bind(canvas), (o, object) => {
//   console.log('element added ...')
// })
// // canvas.renderAll();
// setTimeout( () => {
//   const stream = canvas.createPNGStream();
//   stream.on('data', function(chunk) {
//     out.write(chunk);
//   });
// }, 5000)
